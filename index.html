<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2025 福盛園藝聖誕節諾貝松預購</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* 🌲 聖誕諾貝松主題顏色變數 */
    :root {
      --christmas-green: #154734;   /* 聖誕主綠 (深松綠) */
      --accent-red: #A80E2F;        /* 節慶點綴紅 */
      --pine-shadow: #082119;       /* 松葉陰影深綠 */
      --snow-white: #F8F8F8;        /* 雪白背景/卡片色 */
      --accent-gold: #D4AF37;       /* 裝飾金 */

      /* 基本色彩 */
      --text-dark: #1C1C1C;         /* 主要深色文字 */
      --text-light: #6B7280;        /* 次要淺色文字 */
      --border-color: #E5E7EB;      /* 一般邊框 */

      /* 效果 */
      --shadow: 0 5px 15px rgba(21, 71, 52, 0.2); /* 帶有綠色的陰影，更有質感 */
      --shadow-hover: 0 10px 25px rgba(21, 71, 52, 0.3);
      --christmas-gradient: linear-gradient(135deg, var(--christmas-green) 0%, var(--accent-red) 100%);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-dark);
      /* 調整為更柔和的雪地背景 */
      background: linear-gradient(135deg, #f0f8f0 0%, #ffffff 100%); 
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    .header {
      /* 使用聖誕漸層 */
      background: var(--christmas-gradient); 
      color: white;
      padding: 60px 0;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      /* 雪花或微光點圖案 */
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="stars" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="2" fill="rgba(255,255,255,0.15)"/></pattern></defs><rect width="100" height="100" fill="url(%23stars)"/></svg>');
      opacity: 0.4;
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    /* Sections */
    .section {
      background: white;
      margin: 30px 0;
      padding: 40px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      /* 使用淺綠色系邊框 */
      border: 1px solid rgba(21, 71, 52, 0.1); 
    }

    .section:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-5px);
    }

    .section h2 {
      /* 標題顏色使用主綠色 */
      color: var(--christmas-green); 
      font-size: 1.8rem;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 15px;
      font-weight: 600;
    }

    .section h2::before {
      content: '';
      width: 4px;
      height: 30px;
      /* 標題裝飾使用漸層 */
      background: var(--christmas-gradient); 
      border-radius: 2px;
    }

    /* Info Cards */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .info-card {
      /* 卡片背景使用雪白 */
      background: var(--snow-white); 
      padding: 25px;
      border-radius: 15px;
      /* 邊框使用點綴紅 */
      border-left: 5px solid var(--accent-red); 
      transition: all 0.3s ease;
    }

    .info-card:hover {
      transform: translateX(10px);
      /* 陰影使用點綴紅 */
      box-shadow: 0 5px 15px rgba(168, 14, 47, 0.2); 
    }

    .info-card h3 {
      /* 標題使用深綠色 */
      color: var(--pine-shadow); 
      margin-bottom: 15px;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .info-card ul {
      list-style: none;
      padding-left: 0;
    }

    .info-card li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
    }

    .info-card li::before {
      /* 項目符號使用聖誕樹圖案 */
      content: '🎄'; 
      position: absolute;
      left: 0;
      top: 8px;
    }
    
    /* 新增樣式：粗體深紅字 */
    .accent-text {
      color: var(--accent-red); /* 使用定義的節慶點綴紅 */
      font-weight: bold;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
      font-size: 1rem;
    }

    .form-input {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-input:focus {
      outline: none;
      /* 聚焦邊框使用主綠色 */
      border-color: var(--christmas-green); 
      box-shadow: 0 0 0 3px rgba(21, 71, 52, 0.1);
      transform: translateY(-2px);
    }

    /* Radio and Checkbox */
    .radio-group, .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 15px;
    }

    .radio-item, .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px 20px;
      background: white;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .radio-item:hover, .checkbox-item:hover {
      /* Hover 效果使用主綠色和雪白背景 */
      border-color: var(--christmas-green); 
      background: var(--snow-white); 
      transform: translateX(5px);
    }

    .radio-item input[type="radio"], .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      /* 選中顏色使用主綠色 */
      accent-color: var(--christmas-green); 
    }

    .radio-item.checked, .checkbox-item.checked {
      /* 選中狀態使用主綠色和雪白背景 */
      border-color: var(--christmas-green); 
      background: var(--snow-white); 
    }

    /* Product Items */
    .product-list {
      display: grid;
      gap: 15px;
      margin-top: 20px;
    }

    .product-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: white;
      border: 2px solid var(--border-color);
      border-radius: 15px;
      transition: all 0.3s ease;
    }

    .product-item:hover {
      /* Hover 效果使用主綠色 */
      border-color: var(--christmas-green); 
      box-shadow: 0 5px 15px rgba(21, 71, 52, 0.1);
      transform: translateY(-2px);
    }

    .product-name {
      font-weight: 600;
      color: var(--text-dark);
      flex: 1;
    }

    .product-quantity {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-btn {
      width: 40px;
      height: 40px;
      /* 按鈕使用點綴紅 */
      border: 2px solid var(--accent-red); 
      background: white;
      color: var(--accent-red);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .quantity-btn:hover {
      /* Hover 背景使用點綴紅 */
      background: var(--accent-red); 
      color: white;
      transform: scale(1.1);
    }

    .quantity-input {
      width: 80px;
      text-align: center;
      padding: 10px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      font-weight: bold;
      font-size: 1.1rem;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 18px 35px;
      /* 按鈕使用聖誕漸層 */
      background: var(--christmas-gradient); 
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      justify-content: center;
      min-width: 200px;
    }

    .btn:hover {
      transform: translateY(-3px);
      /* 陰影顏色使用點綴紅 */
      box-shadow: 0 10px 25px rgba(168, 14, 47, 0.3); 
    }

    .btn:active {
      transform: translateY(-1px);
    }

    /* Total Section */
    .total-section {
      /* 總計區塊使用聖誕漸層 */
      background: var(--christmas-gradient); 
      color: white;
      text-align: center;
      padding: 30px;
      border-radius: 20px;
      margin: 30px 0;
    }

    .total-amount {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    /* Hidden Elements */
    .hidden {
      display: none;
    }

    .slide-down {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Thank You Page */
    .thank-you {
      text-align: center;
      padding: 60px 40px;
      background: white;
      border-radius: 20px;
      box-shadow: var(--shadow);
      margin: 40px 0;
    }

    .thank-you h2 {
      /* 標題顏色使用點綴紅 */
      color: var(--accent-red); 
      font-size: 2.5rem;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .order-summary {
      /* 背景使用雪白 */
      background: var(--snow-white); 
      border-radius: 15px;
      padding: 30px;
      margin: 30px 0;
      text-align: left;
    }

    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .summary-table th,
    .summary-table td {
      padding: 15px 20px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .summary-table th {
      /* 表格頭部使用聖誕漸層 */
      background: var(--christmas-gradient); 
      color: white;
      font-weight: 600;
    }

    .summary-table tr:hover {
      /* Hover 背景使用雪白 */
      background: var(--snow-white); 
    }

    /* Iframe Container */
    .iframe-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      margin: 25px 0;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .iframe-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* 📌 新增：圖片容器樣式 (用於替換 iframe) */
    .image-container {
      position: relative;
      width: 100%;
      margin: 25px 0;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: var(--shadow);
      /* 確保圖片在容器內正常顯示 */
    }
    
    .image-container img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* Mobile Responsive (保持不變) */
    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
      }

      .header {
        padding: 40px 0;
      }

      .header h1 {
        font-size: 2rem;
      }

      .section {
        margin: 20px 0;
        padding: 25px 20px;
        border-radius: 15px;
      }

      .section h2 {
        font-size: 1.5rem;
      }

      .info-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .product-item {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }

      .product-quantity {
        justify-content: center;
      }

      .radio-group, .checkbox-group {
        gap: 10px;
      }

      .radio-item, .checkbox-item {
        padding: 12px 15px;
      }

      .btn {
        width: 100%;
        padding: 15px 25px;
      }

      .total-amount {
        font-size: 2rem;
      }

      .thank-you {
        padding: 40px 20px;
      }

      .summary-table th,
      .summary-table td {
        padding: 12px 15px;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 1.7rem;
      }

      .section {
        padding: 20px 15px;
      }

      .form-input {
        padding: 12px 15px;
      }

      .quantity-btn {
        width: 35px;
        height: 35px;
      }

      .quantity-input {
        width: 70px;
        padding: 8px;
      }
    }

    /* Loading Animation (保持不變) */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Success Animation (保持不變) */
    .success-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--christmas-gradient); /* 使用聖誕漸層 */
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: successPulse 0.6s ease-out;
    }

    @keyframes successPulse {
      0% { transform: scale(0); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  </style>
  <script>
    let products = [];
    let backCarFees = {
      "桃園佳欣花店": 0,
      "竹北濱江林花店": 150,
      "苗栗交流道": 150,
      "台中芳林花卉": 150,
      "台中江合花市": 200,
      "豐原交流道": 150,
      "彰化田尾花市": 150,
      "草屯交流道": 200,
      "埔里鎮信義路100號": 200,
      "斗南交流道": 200,
      "嘉義交流道": 200,
      "水上交流道": 200,
      "新營交流道": 200,
      "台南花市": 200,
      "仁德交流道": 200,
      "楠梓交流道": 200,
      "高雄尚陶坊花店": 200,
      "高雄花市": 200,
      "屏東國芳花店": 200
    };
    let currentFee = 0;

    function loadProducts() {
      // Check if we're in Google Apps Script environment
      if (typeof google !== 'undefined' && google.script) {
        google.script.run.withSuccessHandler(data => {
          products = data;
          renderProducts();
        }).getProducts();
      } else {
        // Mock data for preview/testing (諾貝松相關商品)
        products = [
          ['美國進口諾貝松 1.5尺 (45cm)', 950],
          ['美國進口諾貝松 2尺 (60cm)', 1200],
          ['美國進口諾貝松 2.5尺 (75cm)', 1500],
          ['美國進口諾貝松 3尺 (90cm)', 1800],
          ['日本雪松+扁柏裝飾組', 700],
          ['美國進口諾貝松樹幹（小型）', 450],
          ['聖誕點綴裝飾包 (紅)', 250],
          ['聖誕點綴裝飾包 (金/銅)', 300],
        ];
        renderProducts();
      }
    }

    function renderProducts() {
      const container = document.getElementById('product-list');
      container.innerHTML = '';
      products.forEach(([name, price], idx) => {
        container.innerHTML += `
          <div class="product-item">
            <div class="product-name">${name} <span class="accent-text">NT$${price}</span></div>
            <div class="product-quantity">
              <button type="button" class="quantity-btn" onclick="changeQuantity(${idx}, -1)">
                <i class="fas fa-minus"></i>
              </button>
              <input type="number" min="0" value="0" class="quantity-input" onchange="calculateTotal()" id="qty-${idx}">
              <button type="button" class="quantity-btn" onclick="changeQuantity(${idx}, 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>`;
      });
    }

    function changeQuantity(index, change) {
      const input = document.getElementById(`qty-${index}`);
      const currentValue = parseInt(input.value) || 0;
      const newValue = Math.max(0, currentValue + change);
      input.value = newValue;
      calculateTotal();
    }

    function calculateTotal() {
      let total = 0;
      products.forEach(([name, price], idx) => {
        const qty = parseInt(document.getElementById('qty-'+idx).value) || 0;
        total += qty * price;
      });

      const delivery = document.querySelector('input[name="delivery"]:checked')?.value || '';
      if (delivery === '回頭車') {
        const place = document.getElementById('backcar-place').value;
        currentFee = backCarFees[place] || 0;
      } else {
        currentFee = 0;
      }

      document.getElementById('total').innerText = (total + currentFee).toLocaleString();

      // ✅ 新增：同步更新「回頭車運費」說明的小字
      const feeText = document.getElementById('backcar-fee');
      if (feeText) {
        feeText.textContent = `NT$${currentFee.toLocaleString()}`;
      }
    }

    function handleDeliveryChange() {
      const value = document.querySelector('input[name="delivery"]:checked').value;
      const deliveryAddress = document.getElementById('delivery-address');
      const backcarOptions = document.getElementById('backcar-options');
      
      deliveryAddress.classList.toggle('hidden', value !== '宅配');
      backcarOptions.classList.toggle('hidden', value !== '回頭車');
      
      if (!deliveryAddress.classList.contains('hidden')) {
        deliveryAddress.classList.add('slide-down');
      }
      if (!backcarOptions.classList.contains('hidden')) {
        backcarOptions.classList.add('slide-down');
      }
      
      // Update radio button styles
      document.querySelectorAll('input[name="delivery"]').forEach(radio => {
        const item = radio.closest('.radio-item');
        if (radio.checked) {
          item.classList.add('checked');
        } else {
          item.classList.remove('checked');
        }
      });
      
      calculateTotal();
    }

    function handleContactChange() {
      document.querySelectorAll('input[name="contact"]').forEach(radio => {
        const item = radio.closest('.radio-item');
        if (radio.checked) {
          item.classList.add('checked');
        } else {
          item.classList.remove('checked');
        }
      });
    }

    function handleAgreeChange() {
      const checkbox = document.getElementById('agree');
      const item = checkbox.closest('.checkbox-item');
      if (checkbox.checked) {
        item.classList.add('checked');
      } else {
        item.classList.remove('checked');
      }
    }

    function submitOrder() {
      const submitBtn = document.querySelector('.submit-btn');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<div class="loading"></div> 處理中...';
      submitBtn.disabled = true;

      const email = document.getElementById('email').value.trim();
      const agree = document.getElementById('agree').checked;
      const name = document.getElementById('cust-name').value.trim();
      const phone = document.getElementById('cust-phone').value.trim();
      const contactMethod = document.querySelector('input[name="contact"]:checked')?.value || '';
      const contactDetail = document.getElementById('contact-detail').value.trim();
      const date = document.getElementById('pickup-date').value;
      const delivery = document.querySelector('input[name="delivery"]:checked')?.value || '';
      const address = document.getElementById('address').value.trim();
      const backcarPlace = document.getElementById('backcar-place').value;
      const remitLast5 = document.getElementById('remit-last5').value.trim();
      const remitBank = document.getElementById('remit-bank').value.trim();

      if (!email) { 
        alert("請輸入電子郵件"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!agree) { 
        alert("請先勾選同意訂購須知"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!name) { 
        alert("請輸入姓名"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!phone) { 
        alert("請輸入電話"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!contactMethod) { 
        alert("請選擇聯絡方式"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!contactDetail) { 
        alert("請填寫詳細聯絡資訊"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      // 諾貝松通常是指定日期，這裡日期欄位檢查不變
      if (!date) { 
        alert("請選擇預計取貨日"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!delivery) { 
        alert("請選擇配送方式"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (delivery === '宅配' && !address) { 
        alert("請填寫宅配地址"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (delivery === '回頭車' && !backcarPlace) { 
        alert("請選擇回頭車地點"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!remitLast5) { 
        alert("請輸入匯款帳號後五碼"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }
      if (!remitBank) { 
        alert("請輸入銀行代碼"); 
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return; 
      }

      const items = [];
      products.forEach(([nameP, price], idx) => {
        const qty = parseInt(document.getElementById('qty-'+idx).value) || 0;
        if (qty > 0) {
          items.push({ name: nameP, qty: qty, subtotal: qty * price });
        }
      });

      if (items.length === 0) {
        alert("請至少選擇一項商品");
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        return;
      }

      const orderData = {
        email, name, phone,
        contactMethod, contactDetail,
        date, delivery, address, backcarPlace,
        remitLast5, remitBank,
        fee: currentFee,
        items
      };

      // Check if we're in Google Apps Script environment
      if (typeof google !== 'undefined' && google.script) {
        google.script.run.withSuccessHandler(() => showThankYou(orderData))
          .withFailureHandler(() => {
            alert('訂單提交失敗，請稍後再試');
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
          })
          .submitOrder(orderData);
      } else {
        // For preview/testing - simulate success
        setTimeout(() => showThankYou(orderData), 1000);
      }
    }

    function showThankYou(orderData) {
      const totalAmount = orderData.items.reduce((s,i)=>s+i.subtotal,0) + orderData.fee;

      // 顯示配送方式細節
      let deliveryDetail = orderData.delivery;
      if (orderData.delivery === '宅配') {
        deliveryDetail += `（地址：${orderData.address}）`;
      } else if (orderData.delivery === '回頭車') {
        deliveryDetail += `（地點：${orderData.backcarPlace}）`;
      }

      document.body.innerHTML = `
        <div class="container">
          <div class="thank-you">
            <div class="success-icon">
              <i class="fas fa-check" style="font-size: 2rem; color: white;"></i>
            </div>
            <h2><i class="fas fa-star"></i> 感謝您的預購！</h2>

            <div class="order-summary">
              <h3 style="color: var(--accent-red); margin-bottom: 20px;"><i class="fas fa-user"></i> 訂購人資料</h3>
              <table class="summary-table">
                <tr><td style="font-weight: 600;">電子郵件</td><td>${orderData.email}</td></tr>
                <tr><td style="font-weight: 600;">姓名</td><td>${orderData.name}</td></tr>
                <tr><td style="font-weight: 600;">電話</td><td>${orderData.phone}</td></tr>
                <tr><td style="font-weight: 600;">聯絡方式</td><td>${orderData.contactMethod}</td></tr>
                <tr><td style="font-weight: 600;">聯絡資訊</td><td>${orderData.contactDetail}</td></tr>
                <tr><td style="font-weight: 600;">配送方式</td><td>${deliveryDetail}</td></tr>
                <tr><td style="font-weight: 600;">取貨日</td><td>${orderData.date}</td></tr>
                <tr><td style="font-weight: 600;">匯款後五碼</td><td>${orderData.remitLast5}</td></tr>
                <tr><td style="font-weight: 600;">銀行代碼</td><td>${orderData.remitBank}</td></tr>
              </table>
            </div>

            <div class="order-summary">
              <h3 style="color: var(--accent-red); margin-bottom: 20px;"><i class="fas fa-box-open"></i> 訂購明細</h3>
              <table class="summary-table">
                <thead>
                  <tr><th>商品</th><th>數量</th><th>小計</th></tr>
                </thead>
                <tbody>
                  ${orderData.items.map(it => 
                    `<tr><td>${it.name}</td><td>${it.qty}</td><td>NT$ ${it.subtotal.toLocaleString()}</td></tr>`
                  ).join('')}
                  ${
                    orderData.fee > 0
                      ? `<tr style="background: var(--snow-white);">
                          <td colspan="2" style="font-weight: 600; color: var(--accent-red);">運費（${orderData.delivery === '回頭車' ? orderData.backcarPlace : '宅配'}）</td>
                          <td style="font-weight: 600; color: var(--accent-red);">NT$ ${orderData.fee.toLocaleString()}</td>
                        </tr>`
                      : ''
                  }
                </tbody>
              </table>
            </div>

            <div class="total-section">
              <h3><i class="fas fa-calculator"></i> 總金額</h3>
              <div class="total-amount">NT$ ${totalAmount.toLocaleString()}</div>
              <p style="font-size: 1.2rem; margin-top: 20px;">
                <i class="fas fa-university"></i> 匯款帳號：101(瑞興銀行)-0127221335660
              </p>
            </div>

            <div style="background: var(--snow-white); padding: 30px; border-radius: 15px; margin-top: 30px; text-align: left; border: 1px solid var(--border-color);">
              <h4 style="color: var(--christmas-green); margin-bottom: 15px; font-size: 1.3rem;">
                <i class="fas fa-info-circle"></i> 接下來請完成以下步驟：
              </h4>
              <ol style="padding-left: 20px; line-height: 1.8; font-size: 1.1rem;">
                <li style="margin-bottom: 10px;">請截圖此頁面保存訂單資訊</li>
                <li style="margin-bottom: 10px;">匯款至指定帳戶</li>
                <li style="margin-bottom: 10px;">將訂單截圖及匯款證明一起傳送至官方LINE</li>
              </ol>
              <div style="text-align: center; margin-top: 25px;">
                <a href="https://lin.ee/0fE8Knb" target="_blank" class="btn" style="text-decoration: none;">
                  <i class="fab fa-line"></i> 前往福盛園藝 LINE 官方帳號
                </a>
              </div>
            </div>
          </div>
        </div>
      `;
    }


    window.onload = () => {
      const select = document.getElementById('backcar-place');
      const defaultOpt = document.createElement('option');
      defaultOpt.value = '';
      defaultOpt.text = '請選擇';
      select.appendChild(defaultOpt);

      Object.keys(backCarFees).forEach(place => {
        const opt = document.createElement('option');
        opt.value = place;
        opt.text = place;
        select.appendChild(opt);
      });

      loadProducts();
    };
  </script>
</head>
<body>
  <div class="header">
    <div class="container">
      <div class="header-content">
        <h1><i class="fas fa-tree"></i> 2025 福盛園藝聖誕節諾貝松預購表單</h1>
        <div class="subtitle">
          <i class="fas fa-star"></i>
          <span>限定預購 · 新鮮空運 · 節慶佈置首選</span>
          <i class="fas fa-star"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="section">
      <h2><i class="fas fa-info-circle"></i> 訂購須知</h2>
      
      <div class="info-grid">
        <div class="info-card">
          <h3><i class="fas fa-exclamation-triangle"></i> 訂購風險說明</h3>
          <ul>
            <li>諾貝松為<span class="accent-text">進口葉材</span>，運輸過程有些無法避免的情況，如折損、掉葉、姿態不均，有要求者，建議至店鋪挑選。</li>
            <li>預計<span class="accent-text">11月中旬抵台</span>，但可能會遇到班機延誤，到貨時間皆有風險，請自行衡量訂購，若無法如期到貨，會再另行通知。</li>
            <li>此次預訂完成，<span class="accent-text">無法取消退款</span>，訂購前請確認好訂購內容。</li>
            <li>原封原裝進口諾貝松每綑約<span class="accent-text">5公斤重</span>，其中 NG 數量約佔 1–2 支屬正常損耗範圍。</li>
          </ul>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-money-bill-wave"></i> 預購價格及運費說明</h3>
          <ul>
            <li>訂購最低量：約<span class="accent-text">5公斤重/捆</span></li>
            <li>預購價：<span class="accent-text">NT$2,800/綑</span> (不含配送運費)，運費另計。</li>
            <li>預購截止日為 <span class="accent-text">2025/10/31</span>，活動截止後將恢復原價，恕不提供預購優惠。</li>
            <li>運費請見下方 <span class="accent-text">配送方式</span> 選擇結果。</li>
          </ul>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-credit-card"></i> 訂購流程及匯款資訊</h3>
          <ul>
            <li>請填寫此表單後，截圖訂購完成畫面，匯款至指定帳戶</li>
            <li>再至 <a href="https://lin.ee/0fE8Knb" target="_blank" class="accent-text" style="text-decoration: none;">福盛官方LINE帳號（請點此）</a> 回傳訂購頁面及匯款證明截圖</li>
            <li><span class="accent-text">匯款資訊：</span><br>
              銀行｜（101）瑞興銀行<br>
              帳號｜0127221335660</li>
          </ul>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-calendar-alt"></i> 重要提醒</h3>
          <ul>
            <li>如有問題，請私訊 <a href="https://lin.ee/0fE8Knb" target="_blank" class="accent-text" style="text-decoration: none;">福盛官方LINE帳號</a>。</li>
            <li>請務必確認所有資訊填寫正確，特別是取貨日及配送方式。</li>
            <li><span class="accent-text">請注意：</span>由於季節限定商品，請儘早預購。</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-user"></i> 訂購人資料</h2>
      
      <div class="form-group">
        <label for="email"><i class="fas fa-envelope"></i> 電子郵件</label>
        <input type="email" id="email" class="form-input" placeholder="請輸入您的電子郵件">
      </div>

      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" id="agree" onchange="handleAgreeChange()">
          <label for="agree" style="margin: 0; cursor: pointer;">
            <i class="fas fa-check-circle"></i> 是，我已閱讀清楚訂購須知
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="cust-name"><i class="fas fa-user"></i> 姓名</label>
        <input type="text" id="cust-name" class="form-input" placeholder="請輸入您的姓名">
      </div>

      <div class="form-group">
        <label for="cust-phone"><i class="fas fa-phone"></i> 電話</label>
        <input type="text" id="cust-phone" class="form-input" placeholder="請輸入您的電話號碼">
      </div>

      <div class="form-group">
        <label><i class="fas fa-comments"></i> 聯絡方式</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" name="contact" value="Facebook" id="contact-fb" onchange="handleContactChange()">
            <label for="contact-fb" style="margin: 0; cursor: pointer;">
              <i class="fab fa-facebook"></i> Facebook
            </label>
          </div>
          <div class="radio-item">
            <input type="radio" name="contact" value="Instagram" id="contact-ig" onchange="handleContactChange()">
            <label for="contact-ig" style="margin: 0; cursor: pointer;">
              <i class="fab fa-instagram"></i> Instagram
            </label>
          </div>
          <div class="radio-item">
            <input type="radio" name="contact" value="LINE" id="contact-line" onchange="handleContactChange()">
            <label for="contact-line" style="margin: 0; cursor: pointer;">
              <i class="fab fa-line"></i> LINE
            </label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="contact-detail"><i class="fas fa-address-card"></i> 詳細聯絡資訊</label>
        <input type="text" id="contact-detail" class="form-input" placeholder="請填寫您的聯絡帳號或ID">
      </div>

      <div class="form-group">
        <label for="pickup-date"><i class="fas fa-calendar"></i> 預計取貨日</label>
        <input type="date" id="pickup-date" class="form-input">
        <small style="color: var(--text-light); margin-top: 8px; display: block;">
          <i class="fas fa-info-circle"></i> 諾貝松預計 <span class="accent-text">11 月中旬</span> 抵達台灣
        </small>
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-tree"></i> 產品選擇</h2>
      <div class="image-container">
        <img src="https://i.meee.com.tw/gFulufr.jpg" alt="諾貝松產品示意圖">
      </div>
      <div id="product-list" class="product-list"></div>
    </div>
    <div class="section">
      <h2><i class="fas fa-truck"></i> 配送方式</h2>
      <div class="radio-group">
        <div class="radio-item">
          <input type="radio" name="delivery" value="台北花市" id="delivery-taipei" onchange="handleDeliveryChange()">
          <label for="delivery-taipei" style="margin: 0; cursor: pointer;">
            <i class="fas fa-map-marker-alt"></i> 台北花市 (自取) - <span class="accent-text">免運費</span>
          </label>
        </div>
        <div class="radio-item">
          <input type="radio" name="delivery" value="宅配" id="delivery-home" onchange="handleDeliveryChange()">
          <label for="delivery-home" style="margin: 0; cursor: pointer;">
            <i class="fas fa-home"></i> 宅配 (運費另計) - 運費：<span class="accent-text">NT$0</span> (需待客服確認報價)
          </label>
        </div>
        <div class="radio-item">
          <input type="radio" name="delivery" value="回頭車" id="delivery-backcar" onchange="handleDeliveryChange()">
          <label for="delivery-backcar" style="margin: 0; cursor: pointer;">
            <i class="fas fa-route"></i> 回頭車配送 (限指定地點)
          </label>
        </div>
      </div>

      <div id="delivery-address" class="form-group hidden" style="margin-top: 25px;">
        <label for="address"><i class="fas fa-map-marked-alt"></i> 宅配地址</label>
        <textarea id="address" class="form-input" rows="3" placeholder="請輸入詳細宅配地址"></textarea>
      </div>

      <div id="backcar-options" class="form-group hidden" style="margin-top: 25px;">
        <label for="backcar-place"><i class="fas fa-handshake"></i> 回頭車指定地點</label>
        <select id="backcar-place" class="form-input" onchange="calculateTotal()"></select>
        <small style="color: var(--text-light); margin-top: 8px; display: block;">
          <i class="fas fa-info-circle"></i> 運費：<span id="backcar-fee" class="accent-text">NT$0</span> (將根據選擇地點自動計算，請選擇地點)
        </small>
      </div>

      <div class="form-group" style="margin-top: 35px;">
        <label for="remit-last5"><i class="fas fa-money-check-alt"></i> 匯款帳號後五碼</label>
        <input type="text" id="remit-last5" class="form-input" placeholder="請輸入匯款帳號後五碼">
      </div>

      <div class="form-group">
        <label for="remit-bank"><i class="fas fa-university"></i> 銀行代碼</label>
        <input type="text" id="remit-bank" class="form-input" placeholder="請輸入匯款銀行代碼 (例: 101)">
      </div>
    </div>

    <div class="total-section">
      <h3><i class="fas fa-calculator"></i> 訂單總金額 (含運費)</h3>
      <div class="total-amount">NT$ <span id="total">0</span></div>
    </div>

    <div style="text-align: center; margin: 40px 0;">
      <button type="button" class="btn submit-btn" onclick="submitOrder()">
        <i class="fas fa-paper-plane"></i> 立即送出預購單
      </button>
    </div>

    <div style="text-align: center; padding: 30px 0; color: var(--text-light); font-size: 0.9rem;">
      <p>&copy; 2025 福盛園藝. All Rights Reserved.</p>
    </div>

  </div>
</body>
</html>
